(this["webpackJsonpreact-app"]=this["webpackJsonpreact-app"]||[]).push([[0],{23:function(t,n,e){},24:function(t,n,e){},44:function(t,n,e){"use strict";e.r(n);var r=e(3),i=e.n(r),o=e(18),s=e.n(o),a=(e(23),e(24),e(7)),c=e.n(a),l=e(0);c.a.defaults.xsrfCookieName="csrftoken",c.a.defaults.xsrfHeaderName="X-CSRFToken";var u,d=function(){var t=function(t){var n=null;if(document.cookie&&""!==document.cookie)for(var e=document.cookie.split(";"),r=0;r<e.length;r++){var i=e[r].replace(" ","");if(i.substring(0,t.length+1)===t+"="){n=decodeURIComponent(i.substring(t.length+1));break}}return n}("csrftoken");return Object(l.jsx)("input",{type:"hidden",name:"csrfmiddlewaretoken",value:null!==t&&void 0!==t?t:""})},f=e(4),h=e(5),v=e(2),g=e(9);function y(t,n){var e,r=[],i=Object(g.a)(t);try{for(i.s();!(e=i.n()).done;){var o=e.value,s=r[r.length-1];s&&s.length<n?s.push(o):r.push([o])}}catch(a){i.e(a)}finally{i.f()}return r}function p(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,e=t.tag,r=t.lines;return y(r,n).map((function(t){return{tag:e,body:t.join("\n")}}))}!function(t){t[t.withFlowOrder=0]="withFlowOrder",t[t.withBodyOrder=1]="withBodyOrder"}(u||(u={}));var b,m,j=function(){function t(n){var e;Object(f.a)(this,t),this.songParts=n,this.title=void 0,this.flow=void 0,this.linkUrl=void 0,this.bodys=[],this.tagBodyMap=new Map,this.bodysWithNoTag=[],this.comments=[];var r,i=Object(g.a)(n);try{for(i.s();!(r=i.n()).done;){var o=r.value;if(o.category===m.title&&(e=void 0,void 0===this.title?this.title=o.lines.join("\n"):this.logDiscard("title",o)),o.category===m.flow&&(e=void 0,void 0===this.flow?this.flow=o.lines.join(" "):this.logDiscard("flow",o," ")),o.category===m.linkUrl&&(e=void 0,void 0===this.linkUrl?this.linkUrl=o.lines.join("\n"):this.logDiscard("linkUrl",o)),o.category===m.tag&&(e=o.lines[0].toUpperCase()||void 0,console.error("set current tag",e),o.lines.length>1&&this.logDiscard("tag",o.lines.slice(1),", ")),o.category===m.body){console.error("current tag for body",e);var s=this.bodys[this.bodys.length-1];s&&e&&s.tag===e?s.lines=s.lines.concat(o.lines):this.bodys.push({tag:e,lines:o.lines})}o.category===m.comment&&this.comments.push(o.lines.join("\n"))}}catch(a){i.e(a)}finally{i.f()}this.bodysWithNoTag=this.bodys.filter((function(t){return void 0===t.tag})),this.tagBodyMap=new Map(this.bodys.flatMap((function(t){var n=t.tag,e=t.lines;return n?[{tag:n,lines:e}]:[]})).map((function(t){return[t.tag,t]})))}return Object(h.a)(t,[{key:"logDiscard",value:function(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"\n";n instanceof Array?console.error("".concat(t," part (").concat(n,") is discarded")):console.error("".concat(t," part (").concat(n.lines.join(e),") is discarded"))}},{key:"toSlideBodyOrder",value:function(){return this.bodys.flatMap((function(t){return p(t)}))}},{key:"toSlideFlowOrder",value:function(){var t=this;if(void 0===this.flow)return this.toSlideBodyOrder();var n=C(this.flow).map((function(t){return t.toUpperCase()})).map((function(n){return n&&t.tagBodyMap.get(n)||n})).flatMap((function(t){return"string"===typeof t?[{tag:t,body:""}]:p(t)})),e=this.bodysWithNoTag.flatMap((function(t){return p(t)}));return n.concat(e)}},{key:"toSlides",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u.withFlowOrder;switch(t){case u.withFlowOrder:return this.toSlideFlowOrder();case u.withBodyOrder:default:return this.toSlideBodyOrder()}}},{key:"toString",value:function(){return"\n\t\t\t* title: ".concat(this.title,"\n\t\t\t* flow: ").concat(this.flow,"\n\t\t\t* linkUrl: ").concat(this.linkUrl,"\n\t\t\t* bodys: ").concat(this.bodys.map((function(t){var n=t.tag,e=t.lines;return"[".concat(n,"]\n").concat(e.join("\n"))})).join("\n\n"),"\n\t\t\t* tagBodyMap: ").concat(this.tagBodyMap,"\n\t\t\t* bodysWithNoTag: ").concat(this.bodysWithNoTag,"\n\t\t\t* comments: ").concat(this.comments,"\n\t\t")}}]),t}(),O=e(8);!function(t){t[t.empty=0]="empty",t[t.linkUrl=1]="linkUrl",t[t.tag=2]="tag",t[t.flow=3]="flow",t[t.title=4]="title",t[t.comment=5]="comment",t[t.body=6]="body",t[t.date=7]="date",t[t.separator=8]="separator",t[t.unknown=9]="unknown"}(m||(m={}));var w=[/^V\d?$/i,/^P?C\d?$/i,/^B\d?$/i,/^E(nding)$/i],k=[].concat(w,[/^x\d$/i,/^\uac04\uc8fc$/]),x=function(t){return k.some((function(n){return n.test(t)}))},C=function(t){return t.split(/[\W_]/).filter((function(t){return/\w/.test(t)}))},U=[/^[-=*][-=* ]+[-=*]$/],B=5,F=0,M=[m.comment,m.title,m.flow,m.linkUrl],S=(b={},Object(v.a)(b,m.empty,(function(t){return""===t?B:F})),Object(v.a)(b,m.date,(function(t){})),Object(v.a)(b,m.title,(function(t){var n=0;return/^\d./.test(t)&&(n+=2),/\(\w\)$/.test(t)&&(n+=2),/\(\w->\w\)$/.test(t)&&(n+=1),n})),Object(v.a)(b,m.linkUrl,(function(t){return/^https?:\/\/.*$/.test(t)?B:F})),Object(v.a)(b,m.flow,(function(t){var n=C(t);if(1===n.length)return F;var e=n.filter(x);return Math.ceil(5*e.length/n.length)})),Object(v.a)(b,m.tag,(function(t){return n=t,w.some((function(t){return t.test(n)}))?B:/^[A-Z]{,2}\d?$/i.test(t)?3:void 0;var n})),Object(v.a)(b,m.body,(function(t){return/^[\w,"'.)( ]+$/i.test(t)?2:1})),Object(v.a)(b,m.comment,(function(t){return/[\uac00-\ud7a3]+/.test(t)?2:1})),Object(v.a)(b,m.separator,(function(t){return n=t,U.some((function(t){return t.test(n)}))?B:F;var n})),b),P=function t(n){var e;Object(f.a)(this,t),this.text=n,this.inferedCategory=void 0;var r=Object(O.a)(m).getValues();this.inferedCategory=null!==(e=r.reduce((function(t,e){var r;if((null===t||void 0===t?void 0:t.score)===B)return t;var i=S[e],o=null===i||void 0===i?void 0:i(n);return void 0!==o&&o>(null!==(r=null===t||void 0===t?void 0:t.score)&&void 0!==r?r:-1)?{value:e,score:o}:t}),void 0))&&void 0!==e?e:{value:m.unknown,score:5}},$=function(){function t(n){Object(f.a)(this,t),this.lines=void 0,this.songsCache=void 0,this.done=!1,this.lines=n.trim().split("\n").map((function(t){return t.trim()})).reduce((function(t,n){var e,r=null!==(e=t[t.length-1])&&void 0!==e?e:"";return""===n&&""===r.text||t.push(new P(n)),t}),[])}return Object(h.a)(t,[{key:"songs",value:function(){if(this.songsCache)return this.songsCache;for(var t=this.getSongParts(),n=[],e=0;-1!==e&&e<t.length;){var r=t[e];if(r.category===m.separator){var i=t.slice(0,e);if(N(i)){n.push(i),t.splice(0,e),e=1;continue}}else if(M.includes(r.category)){if("continue"===function(){var i,o=t.slice(e).findIndex((function(t){return t.category===m.body})),s=-1!==o?e+o:void 0;if(console.error("current",r.lines,"firstbody",null===(i=t[null!==s&&void 0!==s?s:-1])||void 0===i?void 0:i.lines),void 0!==s){var a=function(){var n=t.slice(e,s).map((function(t){return t.category}));return console.error("categories",n.map((function(t){return Object(O.a)(m).getKeyOrDefault(t)}))),n.includes(m.title)||n.includes(m.flow)||n.includes(m.linkUrl)}();if(console.error("is title section",a,"\n"),a){var c=t.slice(0,e);return N(c)&&(n.push(c),t.splice(0,e)),console.error("current index",e,"->",o),e=o,"continue"}return console.error("current index",e,"->",s),e=o,"continue"}}())continue}e+=1}return N(t)&&n.push(t),this.songsCache=n.map((function(t){return new j(t)})),this.songsCache}},{key:"getSongParts",value:function(){var t=this,n=[];return this.lines.forEach((function(t,e){var r=n[n.length-1];void 0===r?n.push({start:e,category:t.inferedCategory.value}):r.category!==t.inferedCategory.value&&(r.end=e,n.push({start:e,category:t.inferedCategory.value}))})),n[n.length-1]&&(n[n.length-1].end=this.lines.length),n.flatMap((function(n){var e=n.start,r=n.end,i=n.category;return void 0===r?[]:[{start:e,end:r,category:i,lines:t.lines.slice(e,r).map((function(t){return t.text}))}]}))}}]),t}();function N(t){return t.filter((function(t){return t.category===m.body})).length>0}function T(t){var n=t.tag,e=t.body;return["[[".concat(null!==n&&void 0!==n?n:"","]]"),e||n].join("\n")}function D(t){return t.map(T).join("\n---\n")}var W=function(){function t(n){Object(f.a)(this,t),this.lineParser=void 0,this.songParsers=void 0,this.lineParser=new $(n),this.songParsers=this.lineParser.songs()}return Object(h.a)(t,[{key:"toFormText",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u.withFlowOrder;return this.songParsers.map((function(n){return D(n.toSlides(t))})).join("\n===\n")}}]),t}();var R=function(){var t=Object(r.useRef)(null),n=Object(r.useRef)(null),e=Object(r.useRef)(null);return Object(l.jsxs)("div",{className:"App",children:[Object(l.jsxs)("form",{id:"lyrics_form",name:"lyrics_form",ref:t,method:"post",action:"",children:[Object(l.jsx)(d,{}),Object(l.jsx)("input",{ref:e,type:"hidden",name:"body"})]}),Object(l.jsxs)("div",{children:[Object(l.jsx)("textarea",{className:"form-control",ref:n,id:"lyrics"}),Object(l.jsx)("div",{children:Object(l.jsx)("button",{className:"btn btn-primary",onClick:function(){var r;if(t.current&&n.current&&e.current){var i=null===(r=n.current)||void 0===r?void 0:r.value;if(i){var o=new W(i).toFormText();e.current.value=o,t.current.submit()}}},children:"\uc81c\ucd9c"})})]})]})},I=function(t){t&&t instanceof Function&&e.e(3).then(e.bind(null,45)).then((function(n){var e=n.getCLS,r=n.getFID,i=n.getFCP,o=n.getLCP,s=n.getTTFB;e(t),r(t),i(t),o(t),s(t)}))};s.a.render(Object(l.jsx)(i.a.StrictMode,{children:Object(l.jsx)(R,{})}),document.getElementById("root")),I()}},[[44,1,2]]]);
//# sourceMappingURL=main.6147da61.chunk.js.map